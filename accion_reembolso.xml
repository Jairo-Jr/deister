<!-- SOLO PARA REEMBOLZABLES -->

<call>
   <args>
      <arg>${docser}</arg>
      <arg>${feccon}</arg>
   </args>
<![CDATA[
<xsql-script>
    <args>
        <arg name='p_docori' type='string'/>
        <arg name='p_feccon' type='date'/>
    </args>

    <body>
    
        <select prefix='gvenalbh_'>
            <columns>
                MIN(fecmov) + 3 fecha
            </columns>
            <from table='gvenalbh' />
            <where>
                docori = <p_docori/>
            </where>
        </select>   
    
        <if>
            <expr>
                <isnotnull><gvenalbh_fecha/></isnotnull>
            </expr>
            <then>
                <exception code='GENAPUNTES'  message='No se puede descontabilizar ya que existe Re-Facturación asociada a factura [{0}].'>
                    <arg><p_docori /></arg>
                </exception>
            </then>
        </if>
        
        <set name='m_date_max'>
            <add>
                <p_feccon /><date.units type='d'>3</date.units>
            </add>
        </set>
        
        <if>
            <expr>
                <gt><date.current /><m_date_max/></gt>
            </expr>
            <then>
                <exception code='DIFSOCI' message='No se puede descontabilizar ya que ha pasado más de 72 horas de generarse los documentos de Re-Facturación.'/>
            </then>
        </if>

    </body>
</xsql-script>
]]>
</call>



<!-- 
    CABID: 14858

    FACTURA -> ALBARAN -> PEDIDO -> SOLICITUD -> LINEAS -> reembolsable

 -->