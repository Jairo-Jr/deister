<select intotemp='@tmp_albh_refactura'>
    <columns>
        crp_refactura_line.refl_cabdst
    </columns>
    <from table='crp_refactura_line'/>
    <where>
        refl_tabdst IS NOT NULL 
        AND refl_cabdst IS NOT NULL 
        AND refl_lindst IS NOT NULL
        AND refl_tabdst = 'gvenalbh'
    </where>
    <group>1</group>
</select>

<select>
    <columns>
        gvenalbh.docser,
        gvenalbh.fecmov,
        gvenalbh.tercer,
        gvenalbh.estcab,
        gvenalbh.estado
    </columns>
    <from table='gvenalbh'>
        <join table='@tmp_albh_refactura' alias='albh_refactura'>
            <on>gvenalbh.cabid = albh_refactura.refl_cabdst</on>
        </join>
    </from>
    <where>
        1=1
        AND gvenalbh.estado NOT IN ('F', 'P')
        AND NOT EXISTS (SELECT gvenfacl.cabid
                        FROM gvenfacl
                        WHERE gvenfacl.cabori = gvenalbh.cabid
                        AND gvenfacl.tabori = 'gvenmovh')
    </where>
    <order>
        gvenalbh.cabid
    </order>
</select>